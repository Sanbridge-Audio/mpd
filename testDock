#Start dockerfile by creating all the dependencies needed.
FROM alpine AS mpdbuild 
LABEL maintainer="Matt Dickinson <matt@sanbridge.org>" 

#Set the working directory of the dockerfile at this stage.
ENV HOME /root

#Installation of MPD from alpine package.
RUN apk update  && apk add \
	alsa-lib-dev \
	sqlite-dev \
	ffmpeg-dev \
#	mpd \
#	alsa-lib \
#        alsa-plugins-pulse \
        alsa-utils \
        libmpdclient \
        libpulse \
#        mpc \
	&& rm -rf /var/cache/apk/* /tmp/*
	
ENV PYTHONUNBUFFERED=1
RUN apk add --update --no-cache python3 && ln -sf python3 /usr/bin/python
RUN python3 -m ensurepip
#RUN pip3 install --no-cache --upgrade pip setuptools
#RUN pip3 install --user meson
RUN pip3 install meson

#Set the mpd version. Makes it easier to update in the future.
ARG MPD_MAJOR_VERSION=0.23 
ARG MPD_MINOR_VERSION=8


#Download the most recent MPD source file.
ADD https://www.musicpd.org/download/mpd/${MPD_MAJOR_VERSION}/mpd-${MPD_MAJOR_VERSION}.${MPD_MINOR_VERSION}.tar.xz /tmp
RUN tar -xf /tmp/mpd-${MPD_MAJOR_VERSION}.${MPD_MINOR_VERSION}.tar.xz -C /
#ADD https://www.musicpd.org/download/mpd/${MPD_MAJOR_VERSION}/mpd-${MPD_MAJOR_VERSION}.${MPD_MINOR_VERSION}.tar.xz /

#WORKDIR /home

#Change the working directory to MPD for installation.
WORKDIR mpd-${MPD_MAJOR_VERSION}.${MPD_MINOR_VERSION}
